# Нереализованный и частично реализованный функционал

> Документ составлен на основе анализа кодовой базы проекта
> 
> *Последнее обновление: Январь 2026*

---

## Полностью нереализованный функционал

### 1. NumberingRule (Автоматическая нумерация документов)

**Статус:** Модель в БД создана, не используется

**Модель в БД** (`prisma/schema.prisma:506-517`):
```prisma
model NumberingRule {
  id        String   @id @default(cuid())
  name      String
  pattern   String   // Шаблон нумерации, например: "DOG-{YYYY}-{NNN}"
  counter   Int      @default(0)
  isActive  Boolean  @default(true)
  companyId String
}
```

**Что нужно реализовать:**
- [ ] Страница настроек нумерации в `/settings`
- [ ] API `/api/numbering-rules` — CRUD для правил
- [ ] Функция `generateNextNumber(ruleId)` в `src/lib/numbering.ts`
- [ ] Интеграция при создании договоров, смет, актов

---

## Частично реализованный функционал

### 3. Финансовый модуль — заглушки

**Файл:** `src/app/finance/page.tsx`

| Функция | Строка | Статус |
|---------|--------|--------|
| `handleExport()` | 217-220 | ❌ Заглушка `console.log('Export clicked')` |
| `handleBudgetSettings()` | 222-225 | ❌ Заглушка `console.log('Budget settings clicked')` |
| `handleCreateInvoice()` | 231-234 | ❌ Заглушка `console.log('Create invoice clicked')` |
| `handleCreatePayment()` | 236-239 | ❌ Заглушка `console.log('Create payment clicked')` |

**Что нужно реализовать:**

#### Экспорт финансов
- [ ] Модальное окно выбора формата (Excel/PDF)
- [ ] Фильтры по периоду и категориям
- [ ] API endpoint для экспорта

#### Настройки бюджета
- [ ] Модальное окно настроек
- [ ] Установка лимитов по категориям
- [ ] Уведомления при превышении бюджета

#### Счета и платежи
- [ ] Модель `Invoice` в БД
- [ ] Генерация счетов на оплату (PDF)
- [ ] Отслеживание статуса оплаты
- [ ] Интеграция с банковскими выписками

---

### 4. Генерация документов — отключенные типы

**Файл:** `src/app/documents/generate/page.tsx:110-117`

| Тип документа | Статус | Приоритет |
|---------------|--------|-----------|
| Договор подряда | ✅ Работает | — |
| Коммерческое предложение | ❌ `disabled: true` | Высокий |
| Акт выполненных работ (АВР) | ❌ `disabled: true` | Высокий |
| УПД | ❌ `disabled: true` | Средний |
| КС-2 | ❌ `disabled: true` | Средний |
| КС-3 | ❌ `disabled: true` | Средний |

**Что нужно реализовать:**

#### Коммерческое предложение
- [ ] Шаблон в `src/lib/commercial-offer-generator.ts`
- [ ] Включение позиций из сметы
- [ ] Брендирование (логотип компании)

#### АВР (Акт выполненных работ)
- [ ] Шаблон по форме ТОРГ-12 или свободная форма
- [ ] Связь с проектом и сметой
- [ ] Подписи сторон

#### УПД (Универсальный передаточный документ)
- [ ] Шаблон по форме ФНС
- [ ] XML-формат для ЭДО
- [ ] Подпись ЭЦП (опционально)

#### КС-2, КС-3
- [ ] Шаблоны по унифицированным формам
- [ ] Автозаполнение из сметы
- [ ] Расчёт накопительным итогом

---

### 5. Мониторинг и алерты — частичная реализация

**Файл:** `src/lib/alerts.ts`

| Функция | Строка | Статус |
|---------|--------|--------|
| `sendEmailAlert()` | 68-71 | ❌ Заглушка |
| `sendWebhookAlert()` | 73-98 | ✅ Работает |
| `checkPerformanceAlerts()` | 122-156 | ✅ Работает |
| `checkMemoryAlerts()` | 158-175 | ✅ Работает |
| `checkDatabaseAlerts()` | 177-180 | ❌ Пустая функция |
| `checkSecurityAlerts()` | 182-185 | ❌ Пустая функция |

**Что нужно реализовать:**

#### Email-уведомления
```typescript
// src/lib/alerts.ts:68
private async sendEmailAlert(alert: Alert) {
  // TODO: Implement email sending (nodemailer, sendgrid, etc.)
}
```
- [ ] Подключить `nodemailer` или SendGrid
- [ ] Шаблоны писем для разных типов алертов
- [ ] Настройки получателей в `/settings`

#### Мониторинг БД
```typescript
// src/lib/alerts.ts:177
async checkDatabaseAlerts() {
  // TODO: Implement database monitoring
}
```
- [ ] Мониторинг пула соединений Prisma
- [ ] Отслеживание медленных запросов
- [ ] Алерты при недоступности БД

#### Мониторинг безопасности
```typescript
// src/lib/alerts.ts:182
async checkSecurityAlerts() {
  // TODO: Implement security monitoring
}
```
- [ ] Отслеживание неудачных попыток входа
- [ ] Детекция подозрительной активности
- [ ] Алерты при изменении прав доступа

---

**Файл:** `src/lib/monitoring.ts:205-208`

| Метрика | Статус |
|---------|--------|
| Memory usage | ✅ Работает |
| CPU usage | ✅ Работает |
| API requests/errors | ✅ Работает |
| DB connections | ❌ Заглушка `connections: 0` |
| DB queries count | ❌ Заглушка `queries: 0` |
| Slow queries | ❌ Заглушка `slowQueries: 0` |

**Что нужно реализовать:**
- [ ] Prisma middleware для подсчёта запросов
- [ ] Логирование времени выполнения запросов
- [ ] Интеграция с `/api/health`

---

## Сводная таблица

| Модуль | Реализовано | Заглушки | Не реализовано |
|--------|-------------|----------|----------------|
| Проекты | 100% | — | — |
| Задачи | 100% | — | — |
| Сметы | 100% | — | — |
| Документы | 20% | — | 5 типов |
| Финансы | 70% | 4 функции | — |
| График работ | 100% | — | — |
| Нумерация | 0% | — | 100% |
| Мониторинг | 60% | 5 функций | — |
| Согласования | 100% | — | — |
| Чат | 100% | — | — |
| Уведомления | 100% | — | — |

---

## Рекомендуемый порядок реализации

### Фаза 1 (Высокий приоритет)
1. **АВР и Коммерческое предложение** — часто используемые документы
2. **Экспорт финансов** — базовый функционал отчётности
3. **Email-уведомления** — критично для production

### Фаза 2 (Средний приоритет)
4. **УПД, КС-2, КС-3** — для строительных проектов
5. **Счета и платежи** — автоматизация расчётов

### Фаза 3 (Низкий приоритет)
7. **Автонумерация документов** — удобство, но не критично
8. **Мониторинг БД** — оптимизация
9. **Мониторинг безопасности** — hardening

---

*Последнее обновление: Январь 2026*
