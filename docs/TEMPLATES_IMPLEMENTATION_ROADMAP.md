# –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã —à–∞–±–ª–æ–Ω–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

## ‚úÖ –¢–ï–ö–£–©–ò–ô –ü–†–û–ì–†–ï–°–° (01.10.2025)

### –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —ç—Ç–∞–ø—ã:

**‚úÖ –≠—Ç–∞–ø 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (100%)**
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `DocumentTemplate` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–π, —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤, –∞–≤—Ç–æ–Ω—É–º–µ—Ä–∞—Ü–∏–∏
- –°–æ–∑–¥–∞–Ω–∞ –º–æ–¥–µ–ª—å `NumberingRule` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω—É–º–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω—ã enum'—ã: `DocumentCategory`, `TemplateFileType`, `ResetPeriod`
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `Document` —Å –ø–æ–ª–µ–º `generatedFrom` –∏ —Å–≤—è–∑—å—é —Å —à–∞–±–ª–æ–Ω–∞–º–∏
- –ú–∏–≥—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞, seed –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã

**‚úÖ –≠—Ç–∞–ø 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫ (100%)**
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: `docxtemplater`, `pizzip`, `exceljs`, `handlebars`
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

**‚úÖ –≠—Ç–∞–ø 3: –°–æ–∑–¥–∞–Ω–∏–µ —É—Ç–∏–ª–∏—Ç (100%)**
- –°–æ–∑–¥–∞–Ω `DocumentGenerator` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑ HTML, Markdown, DOCX
- –°–æ–∑–¥–∞–Ω `DocumentNumbering` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –î–æ–±–∞–≤–ª–µ–Ω—ã Handlebars helpers (formatDate, formatCurrency –∏ –¥—Ä.)

**‚úÖ –≠—Ç–∞–ø 4: API endpoints (100%)**
- `GET/POST /api/templates` - —Å–ø–∏—Å–æ–∫ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤
- `GET/PUT/DELETE /api/templates/[id]` - —Ä–∞–±–æ—Ç–∞ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —à–∞–±–ª–æ–Ω–æ–º
- `POST /api/templates/[id]/generate` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏–∑ —à–∞–±–ª–æ–Ω–∞
- `GET/POST /api/numbering-rules` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –Ω—É–º–µ—Ä–∞—Ü–∏–∏

### –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ:

**‚è≥ –≠—Ç–∞–ø 5-10: –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (0%)**
- –û–∂–∏–¥–∞—é—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

---

## –û–±–∑–æ—Ä

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π —Å–∏—Å—Ç–µ–º—ã —à–∞–±–ª–æ–Ω–æ–≤ –∏ –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏—è –µ–µ –≤ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç–∞.

---

## –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (—á—Ç–æ –Ω—É–∂–Ω–æ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å)

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
1. **–•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ** - –Ω–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ DOCX/XLSX
2. **–ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤** - —à–∞–±–ª–æ–Ω—ã –Ω–µ–ª—å–∑—è –∑–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–º–∏
3. **–ù–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –∏ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏** - —à–∞–±–ª–æ–Ω—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

### üü° –í–∞–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
4. **–ù–µ—Ç —Å–∏—Å—Ç–µ–º—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ —Ç–∏–ø–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤** - –ø–ª–æ—Ö–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è
5. **–ù–µ—Ç —Å–∏—Å—Ç–µ–º—ã –Ω—É–º–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤** - –Ω–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏—è –Ω–æ–º–µ—Ä–æ–≤

---

## –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### üìã –≠—Ç–∞–ø 1: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (1-2 –¥–Ω—è)

#### –ó–∞–¥–∞—á–∞ 1.1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ DocumentTemplate
```prisma
model DocumentTemplate {
  id           String                @id @default(cuid())
  name         String
  description  String?
  
  // –ù–û–í–û–ï: –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è
  category     DocumentCategory      
  type         String                // –ü–æ–¥—Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞
  
  // –ù–û–í–û–ï: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
  content      String                @db.Text  // HTML/Markdown —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
  filePath     String?               // –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —à–∞–±–ª–æ–Ω–∞ (DOCX/XLSX) –≤ MinIO
  fileType     TemplateFileType      @default(HTML)
  
  variables    Json?                 // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω–∞
  isActive     Boolean               @default(true)
  isPublic     Boolean               @default(false)
  version      Int                   @default(1)
  
  // –ù–û–í–û–ï: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
  autoNumber   Boolean               @default(false)  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è
  numberFormat String?               // –§–æ—Ä–º–∞—Ç: "DOC-{YYYY}-{###}"
  
  // –ù–û–í–û–ï: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
  requiresApproval Boolean           @default(false)
  
  createdAt    DateTime              @default(now())
  updatedAt    DateTime              @updatedAt
  
  companyId    String
  company      Company               @relation(fields: [companyId], references: [id])
  creatorId    String?
  creator      User?                 @relation("TemplateCreator", fields: [creatorId], references: [id])
  documents    Document[]
  
  @@index([companyId])
  @@index([category])
  @@index([type])
  @@index([createdAt])
}
```

#### –ó–∞–¥–∞—á–∞ 1.2: –ù–æ–≤–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –∞–≤—Ç–æ–Ω—É–º–µ—Ä–∞—Ü–∏–∏
```prisma
model NumberingRule {
  id           String          @id @default(cuid())
  category     DocumentCategory
  prefix       String?         // –ü—Ä–µ—Ñ–∏–∫—Å: "DOG-", "SF-"
  format       String          // –§–æ—Ä–º–∞—Ç: "{PREFIX}{YYYY}-{MM}-{###}"
  lastNumber   Int             @default(0)
  resetPeriod  ResetPeriod     @default(YEAR)
  
  companyId    String
  company      Company         @relation(fields: [companyId], references: [id])
  
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  
  @@unique([companyId, category])
  @@index([companyId])
}

enum DocumentCategory {
  COMMERCIAL   // –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ (–¥–æ–≥–æ–≤–æ—Ä—ã, –ö–ü)
  FINANCIAL    // –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ (—Å—á–µ—Ç–∞, –ê–í–†, –ö–°-2)
  REPORT       // –û—Ç—á–µ—Ç–Ω—ã–µ (–æ—Ç—á–µ—Ç—ã, –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏)
  HR           // –ö–∞–¥—Ä–æ–≤—ã–µ (—Ç—Ä—É–¥–æ–≤—ã–µ –¥–æ–≥–æ–≤–æ—Ä—ã, –ø—Ä–∏–∫–∞–∑—ã)
  TECHNICAL    // –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ (–¢–ó, —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏)
  LEGAL        // –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ
  OTHER        // –ü—Ä–æ—á–∏–µ
}

enum TemplateFileType {
  HTML         // HTML —à–∞–±–ª–æ–Ω
  DOCX         // Word –¥–æ–∫—É–º–µ–Ω—Ç
  XLSX         // Excel —Ç–∞–±–ª–∏—Ü–∞
  PDF          // PDF (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞)
  MARKDOWN     // Markdown
}

enum ResetPeriod {
  NEVER        // –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å
  YEAR         // –ö–∞–∂–¥—ã–π –≥–æ–¥ (01.01)
  MONTH        // –ö–∞–∂–¥—ã–π –º–µ—Å—è—Ü (01.XX)
  QUARTER      // –ö–∞–∂–¥—ã–π –∫–≤–∞—Ä—Ç–∞–ª
}
```

#### –ó–∞–¥–∞—á–∞ 1.3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ Document
```prisma
model Document {
  id              String            @id @default(cuid())
  title           String
  description     String?
  
  // –ù–û–í–û–ï: –°–≤—è–∑—å —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π
  category        DocumentCategory?
  
  // –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  fileName        String
  filePath        String
  fileSize        Int
  mimeType        String
  documentNumber  String?
  isLatest        Boolean           @default(true)
  
  // –ù–û–í–û–ï: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
  generatedFrom   Json?             // –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
  
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  
  projectId       String?
  project         Project?          @relation(fields: [projectId], references: [id])
  creatorId       String
  creator         User              @relation("DocumentCreator", fields: [creatorId], references: [id])
  templateId      String?
  template        DocumentTemplate? @relation(fields: [templateId], references: [id])
  versions        DocumentVersion[]
  approvals       Approval[]
  
  @@index([projectId])
  @@index([creatorId])
  @@index([createdAt])
  @@index([category])
  @@index([documentNumber])
}
```

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `prisma/schema.prisma`
- [ ] –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é: `npx prisma migrate dev --name add_template_categories_and_numbering`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å Prisma Client: `npx prisma generate`

---

### üì¶ –≠—Ç–∞–ø 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫ (30 –º–∏–Ω—É—Ç)

#### –ó–∞–¥–∞—á–∞ 2.1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

```bash
# –î–ª—è DOCX (Word)
npm install docxtemplater pizzip

# –î–ª—è XLSX (Excel)
npm install exceljs

# –î–ª—è HTML —à–∞–±–ª–æ–Ω–æ–≤
npm install handlebars

# –î–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —á–∏—Å–µ–ª –≤ —Å–ª–æ–≤–∞ (—Å—É–º–º–∞ –ø—Ä–æ–ø–∏—Å—å—é)
npm install number-to-words-ru
```

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–µ—Ä—Å–∏–π
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `package.json`

---

### üîß –≠—Ç–∞–ø 3: –°–æ–∑–¥–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (2-3 –¥–Ω—è)

#### –ó–∞–¥–∞—á–∞ 3.1: –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å DocumentGenerator

**–§–∞–π–ª:** `src/lib/document-generator.ts`

```typescript
import Docxtemplater from 'docxtemplater'
import PizZip from 'pizzip'
import ExcelJS from 'exceljs'
import Handlebars from 'handlebars'
import { promises as fs } from 'fs'
import path from 'path'
import { storage } from './storage'

export interface DocumentVariables {
  company?: {
    name: string
    inn?: string
    kpp?: string
    address?: string
    phone?: string
    email?: string
    director?: string
  }
  client?: {
    name: string
    inn?: string
    kpp?: string
    address?: string
    contact?: string
    phone?: string
    email?: string
  }
  project?: {
    id: string
    name: string
    code?: string
    budget?: number
    startDate?: Date
    endDate?: Date
    manager?: string
  }
  contract?: {
    number: string
    date: Date
    amount: number
    currency?: string
  }
  finance?: {
    items: Array<{
      name: string
      quantity: number
      unit: string
      price: number
      total: number
      vat?: number
    }>
    subtotal: number
    vat: number
    total: number
    totalInWords?: string
  }
  current?: {
    date: Date
    year: number
    month: number
    user: string
  }
  document?: {
    number: string
    date: Date
  }
  [key: string]: any
}

export class DocumentGenerator {
  /**
   * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è DOCX –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏–∑ —à–∞–±–ª–æ–Ω–∞
   */
  static async generateDocx(
    templatePath: string,
    variables: DocumentVariables
  ): Promise<Buffer> {
    try {
      // –°–∫–∞—á–∏–≤–∞–µ–º —à–∞–±–ª–æ–Ω –∏–∑ MinIO
      const content = await storage.getFile(templatePath)
      
      const zip = new PizZip(content)
      const doc = new Docxtemplater(zip, {
        paragraphLoop: true,
        linebreaks: true,
      })
      
      // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
      const preparedVars = this.prepareVariables(variables)
      
      // –ó–∞–ø–æ–ª–Ω—è–µ–º —à–∞–±–ª–æ–Ω
      doc.render(preparedVars)
      
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—ã–π —Ñ–∞–π–ª
      const buffer = doc.getZip().generate({
        type: 'nodebuffer',
        compression: 'DEFLATE',
      })
      
      return buffer
    } catch (error) {
      console.error('Error generating DOCX:', error)
      throw new Error(`–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ DOCX: ${error.message}`)
    }
  }
  
  /**
   * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è XLSX –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏–∑ —à–∞–±–ª–æ–Ω–∞
   */
  static async generateXlsx(
    templatePath: string,
    variables: DocumentVariables
  ): Promise<Buffer> {
    try {
      // –°–∫–∞—á–∏–≤–∞–µ–º —à–∞–±–ª–æ–Ω –∏–∑ MinIO
      const content = await storage.getFile(templatePath)
      
      const workbook = new ExcelJS.Workbook()
      await workbook.xlsx.load(content)
      
      // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
      const preparedVars = this.prepareVariables(variables)
      
      // –ó–∞–ø–æ–ª–Ω—è–µ–º —è—á–µ–π–∫–∏
      workbook.eachSheet((worksheet) => {
        worksheet.eachRow((row) => {
          row.eachCell((cell) => {
            if (typeof cell.value === 'string') {
              cell.value = this.replaceVariables(cell.value, preparedVars)
            }
          })
        })
      })
      
      const buffer = await workbook.xlsx.writeBuffer()
      return buffer as Buffer
    } catch (error) {
      console.error('Error generating XLSX:', error)
      throw new Error(`–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ XLSX: ${error.message}`)
    }
  }
  
  /**
   * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏–∑ —à–∞–±–ª–æ–Ω–∞
   */
  static generateHtml(
    template: string,
    variables: DocumentVariables
  ): string {
    try {
      // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
      const preparedVars = this.prepareVariables(variables)
      
      // –ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º —à–∞–±–ª–æ–Ω
      const compiled = Handlebars.compile(template)
      return compiled(preparedVars)
    } catch (error) {
      console.error('Error generating HTML:', error)
      throw new Error(`–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ HTML: ${error.message}`)
    }
  }
  
  /**
   * –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö: —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç, —á–∏—Å–µ–ª –∏ —Ç.–¥.
   */
  private static prepareVariables(variables: DocumentVariables): Record<string, any> {
    const prepared = { ...variables }
    
    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—ã
    if (prepared.contract?.date) {
      prepared.contract.dateFormatted = this.formatDate(prepared.contract.date)
    }
    if (prepared.project?.startDate) {
      prepared.project.startDateFormatted = this.formatDate(prepared.project.startDate)
    }
    if (prepared.project?.endDate) {
      prepared.project.endDateFormatted = this.formatDate(prepared.project.endDate)
    }
    if (prepared.current?.date) {
      prepared.current.dateFormatted = this.formatDate(prepared.current.date)
    }
    if (prepared.document?.date) {
      prepared.document.dateFormatted = this.formatDate(prepared.document.date)
    }
    
    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —á–∏—Å–ª–∞
    if (prepared.contract?.amount) {
      prepared.contract.amountFormatted = this.formatNumber(prepared.contract.amount)
    }
    if (prepared.project?.budget) {
      prepared.project.budgetFormatted = this.formatNumber(prepared.project.budget)
    }
    if (prepared.finance) {
      if (prepared.finance.subtotal) {
        prepared.finance.subtotalFormatted = this.formatNumber(prepared.finance.subtotal)
      }
      if (prepared.finance.total) {
        prepared.finance.totalFormatted = this.formatNumber(prepared.finance.total)
      }
      if (prepared.finance.vat) {
        prepared.finance.vatFormatted = this.formatNumber(prepared.finance.vat)
      }
    }
    
    return prepared
  }
  
  /**
   * –ó–∞–º–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤–∏–¥–∞ {{variable.field}}
   */
  private static replaceVariables(
    text: string,
    variables: Record<string, any>
  ): string {
    return text.replace(/\{\{(\w+(?:\.\w+)*)\}\}/g, (match, key) => {
      const value = this.getNestedValue(variables, key)
      return value !== undefined ? String(value) : match
    })
  }
  
  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –ø—É—Ç–∏ (company.name)
   */
  private static getNestedValue(obj: any, path: string): any {
    return path.split('.').reduce((curr, key) => curr?.[key], obj)
  }
  
  /**
   * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –≤ —Ä—É—Å—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç
   */
  private static formatDate(date: Date): string {
    const d = new Date(date)
    return d.toLocaleDateString('ru-RU', {
      day: '2-digit',
      month: 'long',
      year: 'numeric'
    })
  }
  
  /**
   * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–ª–∞ —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏
   */
  private static formatNumber(num: number): string {
    return num.toLocaleString('ru-RU', {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    })
  }
}
```

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å `src/lib/document-generator.ts`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ DOCX, XLSX, HTML
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã

#### –ó–∞–¥–∞—á–∞ 3.2: –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∞–≤—Ç–æ–Ω—É–º–µ—Ä–∞—Ü–∏–∏

**–§–∞–π–ª:** `src/lib/document-numbering.ts`

```typescript
import { prisma } from './prisma'
import { DocumentCategory, ResetPeriod } from '@prisma/client'

export class DocumentNumbering {
  /**
   * –ü–æ–ª—É—á–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞
   */
  static async getNextNumber(
    companyId: string,
    category: DocumentCategory
  ): Promise<string> {
    // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–∞–≤–∏–ª–æ –Ω—É–º–µ—Ä–∞—Ü–∏–∏
    let rule = await prisma.numberingRule.findUnique({
      where: {
        companyId_category: {
          companyId,
          category
        }
      }
    })
    
    // –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–∞ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ
    if (!rule) {
      rule = await prisma.numberingRule.create({
        data: {
          companyId,
          category,
          format: this.getDefaultFormat(category),
          lastNumber: 0,
          resetPeriod: 'YEAR'
        }
      })
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ —Å–±—Ä–æ—Å–∏—Ç—å —Å—á–µ—Ç—á–∏–∫
    const shouldReset = this.shouldResetCounter(rule.updatedAt, rule.resetPeriod)
    const nextNumber = shouldReset ? 1 : rule.lastNumber + 1
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
    await prisma.numberingRule.update({
      where: { id: rule.id },
      data: { lastNumber: nextNumber }
    })
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–º–µ—Ä –ø–æ —Ñ–æ—Ä–º–∞—Ç—É
    return this.formatNumber(rule.format, nextNumber, rule.prefix)
  }
  
  /**
   * –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω—É–∂–Ω–æ –ª–∏ —Å–±—Ä–æ—Å–∏—Ç—å —Å—á–µ—Ç—á–∏–∫
   */
  private static shouldResetCounter(lastUpdate: Date, period: ResetPeriod): boolean {
    const now = new Date()
    const last = new Date(lastUpdate)
    
    switch (period) {
      case 'NEVER':
        return false
      case 'YEAR':
        return now.getFullYear() > last.getFullYear()
      case 'MONTH':
        return now.getFullYear() > last.getFullYear() || 
               now.getMonth() > last.getMonth()
      case 'QUARTER':
        return Math.floor(now.getMonth() / 3) > Math.floor(last.getMonth() / 3) ||
               now.getFullYear() > last.getFullYear()
      default:
        return false
    }
  }
  
  /**
   * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ –ø–æ —à–∞–±–ª–æ–Ω—É
   * –ü—Ä–∏–º–µ—Ä: "{PREFIX}{YYYY}-{MM}-{###}" -> "DOG-2025-10-001"
   */
  private static formatNumber(
    format: string,
    number: number,
    prefix?: string
  ): string {
    const now = new Date()
    
    let result = format
      .replace('{PREFIX}', prefix || '')
      .replace('{YYYY}', now.getFullYear().toString())
      .replace('{YY}', now.getFullYear().toString().slice(-2))
      .replace('{MM}', (now.getMonth() + 1).toString().padStart(2, '0'))
      .replace('{DD}', now.getDate().toString().padStart(2, '0'))
    
    // –ó–∞–º–µ–Ω—è–µ–º ### –Ω–∞ –Ω–æ–º–µ—Ä —Å –Ω—É–∂–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –Ω—É–ª–µ–π
    const match = result.match(/\{(#+)\}/)
    if (match) {
      const digits = match[1].length
      result = result.replace(match[0], number.toString().padStart(digits, '0'))
    }
    
    return result
  }
  
  /**
   * –ü–æ–ª—É—á–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
   */
  private static getDefaultFormat(category: DocumentCategory): string {
    const formats: Record<DocumentCategory, string> = {
      COMMERCIAL: '{PREFIX}{YYYY}-{###}',
      FINANCIAL: '–°–§-{YYYY}-{###}',
      REPORT: '–û–¢-{YYYY}-{MM}-{###}',
      HR: '–ü–†-{YYYY}-{###}',
      TECHNICAL: '–¢–ó-{YYYY}-{###}',
      LEGAL: '–Æ–†-{YYYY}-{###}',
      OTHER: '–î–û–ö-{YYYY}-{###}'
    }
    
    return formats[category]
  }
}
```

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å `src/lib/document-numbering.ts`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –∞–≤—Ç–æ–Ω—É–º–µ—Ä–∞—Ü–∏–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã

---

### üåê –≠—Ç–∞–ø 4: API Endpoints (2-3 –¥–Ω—è)

#### –ó–∞–¥–∞—á–∞ 4.1: –û–±–Ω–æ–≤–∏—Ç—å API —à–∞–±–ª–æ–Ω–æ–≤

**–§–∞–π–ª:** `src/app/api/templates/route.ts`

–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É:
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–∏–ø—É
- –ó–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ —à–∞–±–ª–æ–Ω–æ–≤ (DOCX/XLSX)
- –í–æ–∑–≤—Ä–∞—Ç–∞ —Å–ø–∏—Å–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —à–∞–±–ª–æ–Ω–∞

#### –ó–∞–¥–∞—á–∞ 4.2: –°–æ–∑–¥–∞—Ç—å API –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

**–§–∞–π–ª:** `src/app/api/documents/generate/route.ts`

```typescript
import { NextRequest, NextResponse } from 'next/server'
import { checkPermission } from '@/lib/auth-middleware'
import { DocumentGenerator } from '@/lib/document-generator'
import { DocumentNumbering } from '@/lib/document-numbering'
import { prisma } from '@/lib/prisma'
import { storage } from '@/lib/storage'

export async function POST(request: NextRequest) {
  try {
    const { allowed, user, error } = await checkPermission(request, 'canCreateDocuments')
    
    if (!allowed) {
      return NextResponse.json({ error: error || '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤' }, { status: 403 })
    }

    const body = await request.json()
    const { templateId, projectId, variables, generateNumber } = body

    // –ü–æ–ª—É—á–∞–µ–º —à–∞–±–ª–æ–Ω
    const template = await prisma.documentTemplate.findUnique({
      where: { id: templateId }
    })

    if (!template) {
      return NextResponse.json({ error: '–®–∞–±–ª–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω' }, { status: 404 })
    }

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    let documentNumber: string | undefined
    if (generateNumber && template.autoNumber && template.category) {
      documentNumber = await DocumentNumbering.getNextNumber(
        user.companyId,
        template.category
      )
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–º–µ—Ä –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    const allVariables = {
      ...variables,
      document: {
        ...variables.document,
        number: documentNumber || variables.document?.number,
        date: new Date()
      },
      current: {
        date: new Date(),
        year: new Date().getFullYear(),
        month: new Date().getMonth() + 1,
        user: user.name
      }
    }

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–æ–∫—É–º–µ–Ω—Ç
    let buffer: Buffer
    let mimeType: string
    let fileName: string

    switch (template.fileType) {
      case 'DOCX':
        buffer = await DocumentGenerator.generateDocx(template.filePath!, allVariables)
        mimeType = 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
        fileName = `${template.name}-${documentNumber || Date.now()}.docx`
        break
        
      case 'XLSX':
        buffer = await DocumentGenerator.generateXlsx(template.filePath!, allVariables)
        mimeType = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
        fileName = `${template.name}-${documentNumber || Date.now()}.xlsx`
        break
        
      case 'HTML':
        const html = DocumentGenerator.generateHtml(template.content, allVariables)
        buffer = Buffer.from(html, 'utf-8')
        mimeType = 'text/html'
        fileName = `${template.name}-${documentNumber || Date.now()}.html`
        break
        
      default:
        return NextResponse.json({ error: '–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø —à–∞–±–ª–æ–Ω–∞' }, { status: 400 })
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª –≤ MinIO
    const filePath = `documents/${user.companyId}/${Date.now()}-${fileName}`
    await storage.uploadFile(filePath, buffer, mimeType)

    // –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –≤ –ë–î
    const document = await prisma.document.create({
      data: {
        title: template.name,
        description: `–°–æ–∑–¥–∞–Ω –∏–∑ —à–∞–±–ª–æ–Ω–∞ "${template.name}"`,
        category: template.category,
        fileName,
        filePath,
        fileSize: buffer.length,
        mimeType,
        documentNumber,
        generatedFrom: allVariables,
        templateId: template.id,
        projectId,
        creatorId: user.id
      }
    })

    return NextResponse.json({
      documentId: document.id,
      number: documentNumber,
      downloadUrl: `/api/documents/${document.id}/download`
    }, { status: 201 })

  } catch (error) {
    console.error('Error generating document:', error)
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })
  }
}
```

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å `/api/documents/generate/route.ts`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å MinIO
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å API —Ç–µ—Å—Ç—ã

#### –ó–∞–¥–∞—á–∞ 4.3: –°–æ–∑–¥–∞—Ç—å API –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–æ–≤

**–§–∞–π–ª:** `src/app/api/templates/upload/route.ts`

```typescript
export async function POST(request: NextRequest) {
  // –ó–∞–≥—Ä—É–∑–∫–∞ DOCX/XLSX —Ñ–∞–π–ª–æ–≤ —à–∞–±–ª–æ–Ω–æ–≤ –≤ MinIO
  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—É—Ç–∏ –≤ –ë–î
}
```

#### –ó–∞–¥–∞—á–∞ 4.4: –°–æ–∑–¥–∞—Ç—å API –Ω—É–º–µ—Ä–∞—Ü–∏–∏

**–§–∞–π–ª:** `src/app/api/numbering/route.ts`

```typescript
// GET /api/numbering/:category - –ü–æ–ª—É—á–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –Ω–æ–º–µ—Ä
// POST /api/numbering/rules - –°–æ–∑–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª–æ
// PUT /api/numbering/rules/:id - –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ
```

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å –≤—Å–µ API endpoints
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API

---

### üé® –≠—Ç–∞–ø 5: Frontend (3-4 –¥–Ω—è)

#### –ó–∞–¥–∞—á–∞ 5.1: –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —à–∞–±–ª–æ–Ω–æ–≤

**–§–∞–π–ª:** `src/app/templates/page.tsx`

–î–æ–±–∞–≤–∏—Ç—å:
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- –ó–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤ —à–∞–±–ª–æ–Ω–æ–≤
- –†–µ–¥–∞–∫—Ç–æ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

#### –ó–∞–¥–∞—á–∞ 5.2: –°–æ–∑–¥–∞—Ç—å —Ñ–æ—Ä–º—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** `src/components/document-generator-form.tsx`

```typescript
interface DocumentGeneratorFormProps {
  templateId: string
  projectId?: string
  onSuccess?: (documentId: string) => void
}

export function DocumentGeneratorForm({ 
  templateId, 
  projectId,
  onSuccess 
}: DocumentGeneratorFormProps) {
  // –§–æ—Ä–º–∞ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞
}
```

#### –ó–∞–¥–∞—á–∞ 5.3: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–∞—Ä—Ç–æ—á–∫—É –ø—Ä–æ–µ–∫—Ç–∞

**–§–∞–π–ª:** `src/app/projects/[id]/page.tsx`

–î–æ–±–∞–≤–∏—Ç—å:
- –í–∫–ª–∞–¥–∫—É "–î–æ–∫—É–º–µ–Ω—Ç—ã"
- –ö–Ω–æ–ø–∫—É "–°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –∏–∑ —à–∞–±–ª–æ–Ω–∞"
- –°–ø–∏—Å–æ–∫ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –û–±–Ω–æ–≤–∏—Ç—å UI —à–∞–±–ª–æ–Ω–æ–≤
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–æ—Ä–º—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç—ã
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ —Ñ–∏–Ω–∞–Ω—Å—ã
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å UX

---

### üß™ –≠—Ç–∞–ø 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (2-3 –¥–Ω—è)

#### –ó–∞–¥–∞—á–∞ 6.1: Unit-—Ç–µ—Å—Ç—ã

```typescript
// –¢–µ—Å—Ç—ã –¥–ª—è DocumentGenerator
// –¢–µ—Å—Ç—ã –¥–ª—è DocumentNumbering
// –¢–µ—Å—Ç—ã –¥–ª—è API endpoints
```

#### –ó–∞–¥–∞—á–∞ 6.2: Integration-—Ç–µ—Å—Ç—ã

```typescript
// –¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞: –∑–∞–≥—Ä—É–∑–∫–∞ —à–∞–±–ª–æ–Ω–∞ ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è ‚Üí —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
// –¢–µ—Å—Ç –∞–≤—Ç–æ–Ω—É–º–µ—Ä–∞—Ü–∏–∏
// –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏
```

#### –ó–∞–¥–∞—á–∞ 6.3: E2E-—Ç–µ—Å—Ç—ã

```typescript
// Playwright —Ç–µ—Å—Ç—ã –¥–ª—è UI
```

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã (–ø–æ–∫—Ä—ã—Ç–∏–µ 80%+)
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å integration-—Ç–µ—Å—Ç—ã
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å E2E-—Ç–µ—Å—Ç—ã
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

### üìö –≠—Ç–∞–ø 7: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (1 –¥–µ–Ω—å)

#### –ó–∞–¥–∞—á–∞ 7.1: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–§–∞–π–ª:** `docs/USER_GUIDE_TEMPLATES.md`

- –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω
- –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- –ö–∞–∫ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
- –ü—Ä–∏–º–µ—Ä—ã —à–∞–±–ª–æ–Ω–æ–≤

#### –ó–∞–¥–∞—á–∞ 7.2: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–§–∞–π–ª:** `docs/DEVELOPER_GUIDE_TEMPLATES.md`

- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
- API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

**–î–µ–π—Å—Ç–≤–∏—è:**
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- [ ] –°–æ–∑–¥–∞—Ç—å –≤–∏–¥–µ–æ-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## –†–µ–∑—é–º–µ: –ü–æ–ª–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç

### ‚úÖ –≠—Ç–∞–ø 1: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (1-2 –¥–Ω—è)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–µ–ª—å `DocumentTemplate`
- [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å `NumberingRule`
- [ ] –î–æ–±–∞–≤–∏—Ç—å enum –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- [ ] –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
- [ ] –û–±–Ω–æ–≤–∏—Ç—å seed –¥–∞–Ω–Ω—ã–µ

### ‚úÖ –≠—Ç–∞–ø 2: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ (30 –º–∏–Ω)
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `docxtemplater`, `pizzip`
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `exceljs`
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `handlebars`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### ‚úÖ –≠—Ç–∞–ø 3: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä (2-3 –¥–Ω—è)
- [ ] –°–æ–∑–¥–∞—Ç—å `DocumentGenerator` –∫–ª–∞—Å—Å
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é DOCX
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é XLSX
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é HTML
- [ ] –°–æ–∑–¥–∞—Ç—å `DocumentNumbering` –∫–ª–∞—Å—Å
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã

### ‚úÖ –≠—Ç–∞–ø 4: API (2-3 –¥–Ω—è)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `/api/templates`
- [ ] –°–æ–∑–¥–∞—Ç—å `/api/templates/upload`
- [ ] –°–æ–∑–¥–∞—Ç—å `/api/documents/generate`
- [ ] –°–æ–∑–¥–∞—Ç—å `/api/numbering`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã

### ‚úÖ –≠—Ç–∞–ø 5: Frontend (3-4 –¥–Ω—è)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —à–∞–±–ª–æ–Ω–æ–≤
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–æ—Ä–º—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç—ã
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ —Ñ–∏–Ω–∞–Ω—Å—ã
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å UX

### ‚úÖ –≠—Ç–∞–ø 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (2-3 –¥–Ω—è)
- [ ] Unit-—Ç–µ—Å—Ç—ã (80%+ –ø–æ–∫—Ä—ã—Ç–∏–µ)
- [ ] Integration-—Ç–µ—Å—Ç—ã
- [ ] E2E-—Ç–µ—Å—Ç—ã
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### ‚úÖ –≠—Ç–∞–ø 7: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (1 –¥–µ–Ω—å)
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] –í–∏–¥–µ–æ-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## –û–±—â–µ–µ –≤—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:** 11-12 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π  
**–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:** 14-16 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π  
**–ü–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:** 18-20 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (MVP):
1. ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ DOCX —à–∞–±–ª–æ–Ω–æ–≤
2. ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤
3. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏
4. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
5. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ XLSX —à–∞–±–ª–æ–Ω–æ–≤
6. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏
7. –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–æ–≤

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
8. HTML/PDF —à–∞–±–ª–æ–Ω—ã
9. –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
10. –í–∏–¥–µ–æ-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

---

## –ß—Ç–æ –Ω—É–∂–Ω–æ –æ—Ç –≤–∞—Å

### –î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
1. **–®–∞–±–ª–æ–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤** (DOCX —Ñ–∞–π–ª—ã):
   - –ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
   - –î–æ–≥–æ–≤–æ—Ä –ø–æ–¥—Ä—è–¥–∞
   - –°—á–µ—Ç
   - –ê–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç (–ê–í–†)
   - –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è (XLSX)

2. **–ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤**:
   - –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏, –ò–ù–ù, –ö–ü–ü, –∞–¥—Ä–µ—Å
   - –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –ª–∏—Ü–∞

3. **–§–æ—Ä–º–∞—Ç –Ω—É–º–µ—Ä–∞—Ü–∏–∏**:
   - –ö–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –Ω–æ–º–µ—Ä–æ–≤ –≤—ã —Ö–æ—Ç–∏—Ç–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞?
   - –ù–∞–ø—Ä–∏–º–µ—Ä: "DOG-2025-001" –¥–ª—è –¥–æ–≥–æ–≤–æ—Ä–æ–≤

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ —à–∞–±–ª–æ–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
2. –Ø –Ω–∞—á–Ω—É —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Å –≠—Ç–∞–ø–∞ 1 (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
3. –ó–∞—Ç–µ–º –ø–µ—Ä–µ–π–¥—É –∫ –≠—Ç–∞–ø—É 3 (–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
4. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ - API –∏ Frontend

–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å? –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –º–Ω–µ –ø–µ—Ä–≤—ã–π —à–∞–±–ª–æ–Ω –¥–æ–≥–æ–≤–æ—Ä–∞ (DOCX), –∏ —è –ø–æ–∫–∞–∂—É, –∫–∞–∫ –µ–≥–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏!

