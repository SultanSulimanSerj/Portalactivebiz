# –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π

## üìã –û–±–∑–æ—Ä

–£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ—â–Ω—ã–π –∏ –≥–∏–±–∫–∏–π –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –±—é–¥–∂–µ—Ç–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞.

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è

- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã**: LOW, MEDIUM, HIGH, URGENT
- **–°—Ä–æ–∫–∏**: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ deadline –¥–ª—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è
- **–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª–∏–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
- **–í–ª–æ–∂–µ–Ω–∏—è**: –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∫ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—é
- **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏**: –û–±—Å—É–∂–¥–µ–Ω–∏–µ –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
- **–ò—Å—Ç–æ—Ä–∏—è**: –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏

- **–†–æ–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤**:
  - `INITIATOR` - –ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è
  - `APPROVER` - –°–æ–≥–ª–∞—Å—É—é—â–∏–π (–ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ)
  - `REVIEWER` - –†–µ—Ü–µ–Ω–∑–µ–Ω—Ç (–¥–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)
  - `OBSERVER` - –ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å (—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä)

- **–ü–æ—Ä—è–¥–æ–∫ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è**: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –∏–ª–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –µ–¥–∏–Ω–æ–≥–ª–∞—Å–∏—è**: –û–ø—Ü–∏—è "—Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–∏–µ –≤—Å–µ—Ö"

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è**: –î–æ–∫—É–º–µ–Ω—Ç—ã –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è
- **–ö–æ–Ω—Ç—Ä–æ–ª—å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏**: –ù–µ–æ–¥–æ–±—Ä–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è —Å–∫—Ä—ã—Ç—ã–º–∏
- **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–µ—Ä—Å–∏–π –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

## üîß –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

### Enum'—ã

```prisma
enum ApprovalPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ApprovalParticipantRole {
  INITIATOR
  APPROVER
  REVIEWER
  OBSERVER
}
```

### –ú–æ–¥–µ–ª–∏

#### Approval (–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ)

```prisma
model Approval {
  id          String        @id @default(cuid())
  title       String
  description String?       @db.Text
  status      ApprovalStatus @default(PENDING)
  type        ApprovalType
  priority    ApprovalPriority @default(MEDIUM)
  dueDate     DateTime?
  requireAllApprovals Boolean @default(false)
  autoPublishOnApproval Boolean @default(true)
  
  // –°–≤—è–∑–∏
  comments    ApprovalComment[]
  attachments ApprovalAttachment[]
  history     ApprovalHistory[]
  assignments ApprovalAssignment[]
}
```

#### ApprovalComment (–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π)

```prisma
model ApprovalComment {
  id        String   @id @default(cuid())
  content   String   @db.Text
  createdAt DateTime @default(now())
  
  approvalId String
  userId String
}
```

#### ApprovalAttachment (–í–ª–æ–∂–µ–Ω–∏–µ)

```prisma
model ApprovalAttachment {
  id        String   @id @default(cuid())
  fileName  String
  filePath  String
  fileSize  Int
  mimeType  String
  
  approvalId String
  uploadedById String
}
```

#### ApprovalHistory (–ò—Å—Ç–æ—Ä–∏—è)

```prisma
model ApprovalHistory {
  id        String   @id @default(cuid())
  action    String
  changes   Json?
  createdAt DateTime @default(now())
  
  approvalId String
  userId String
}
```

#### ApprovalAssignment (–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ)

```prisma
model ApprovalAssignment {
  id        String   @id @default(cuid())
  status    ApprovalStatus @default(PENDING)
  role      ApprovalParticipantRole @default(APPROVER)
  comment   String?  @db.Text
  order     Int      @default(0)
  respondedAt DateTime?
  
  approvalId String
  userId String
}
```

## üì° API Endpoints

### –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

#### `GET /api/approvals`
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π.

#### `POST /api/approvals`
–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ.

**Body:**
```json
{
  "title": "–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏",
  "description": "–¢—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –ü–î –ø–æ –æ–±—ä–µ–∫—Ç—É ‚Ññ123",
  "type": "DOCUMENT",
  "priority": "HIGH",
  "dueDate": "2025-10-15T12:00:00Z",
  "requireAllApprovals": true,
  "autoPublishOnApproval": true,
  "documentId": "doc-123",
  "projectId": "proj-456",
  "assigneeIds": ["user-1", "user-2"],
  "roles": {
    "user-1": "APPROVER",
    "user-2": "REVIEWER"
  }
}
```

#### `GET /api/approvals/[id]`
–ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è.

#### `PUT /api/approvals/[id]`
–û–±–Ω–æ–≤–∏—Ç—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ.

#### `DELETE /api/approvals/[id]`
–£–¥–∞–ª–∏—Ç—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ.

### –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

#### `GET /api/approvals/[id]/comments`
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è.

#### `POST /api/approvals/[id]/comments`
–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.

**Body:**
```json
{
  "content": "–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–Ω–µ—Å—Ç–∏ –ø—Ä–∞–≤–∫–∏ –≤ —Ä–∞–∑–¥–µ–ª 3.2"
}
```

### –í–ª–æ–∂–µ–Ω–∏—è

#### `GET /api/approvals/[id]/attachments`
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –≤–ª–æ–∂–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è.

#### `POST /api/approvals/[id]/attachments`
–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–ª–æ–∂–µ–Ω–∏–µ (multipart/form-data).

**FormData:**
- `file`: File

### –ò—Å—Ç–æ—Ä–∏—è

#### `GET /api/approvals/[id]/history`
–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è.

### –û—Ç–≤–µ—Ç –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ

#### `POST /api/approvals/[id]/respond`
–û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ (–æ–¥–æ–±—Ä–∏—Ç—å/–æ—Ç–∫–ª–æ–Ω–∏—Ç—å).

**Body:**
```json
{
  "status": "APPROVED",  // –∏–ª–∏ "REJECTED"
  "comment": "–û–¥–æ–±—Ä–µ–Ω–æ —Å –∑–∞–º–µ—á–∞–Ω–∏—è–º–∏"
}
```

**–õ–æ–≥–∏–∫–∞:**
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (`ApprovalAssignment`)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π
- –û–±–Ω–æ–≤–ª—è–µ—Ç –æ–±—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è
- –ï—Å–ª–∏ `requireAllApprovals = true`, —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–∏–µ –≤—Å–µ—Ö
- –ï—Å–ª–∏ `autoPublishOnApproval = true`, –ø—É–±–ª–∏–∫—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏
- –î–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é

## üé® –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è —Å –≤–ª–æ–∂–µ–Ω–∏—è–º–∏

```typescript
// 1. –°–æ–∑–¥–∞–µ–º —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ
const approval = await fetch('/api/approvals', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    title: '–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –ü–î',
    description: '–¢—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é',
    type: 'DOCUMENT',
    priority: 'HIGH',
    dueDate: '2025-10-15T12:00:00Z',
    requireAllApprovals: true,
    documentId: 'doc-123',
    assigneeIds: ['user-1', 'user-2'],
    roles: {
      'user-1': 'APPROVER',
      'user-2': 'REVIEWER'
    }
  })
})

const { id } = await approval.json()

// 2. –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–ª–æ–∂–µ–Ω–∏—è
const formData = new FormData()
formData.append('file', file)

await fetch(`/api/approvals/${id}/attachments`, {
  method: 'POST',
  body: formData
})
```

### –û—Ç–≤–µ—Ç –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ

```typescript
// 1. –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
await fetch(`/api/approvals/${id}/comments`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    content: '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–Ω–µ—Å—Ç–∏ –ø—Ä–∞–≤–∫–∏ –≤ —Ä–∞–∑–¥–µ–ª 3.2'
  })
})

// 2. –û–¥–æ–±—Ä—è–µ–º —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º
await fetch(`/api/approvals/${id}/respond`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    status: 'APPROVED',
    comment: '–û–¥–æ–±—Ä–µ–Ω–æ —Å –∑–∞–º–µ—á–∞–Ω–∏—è–º–∏'
  })
})
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏

```typescript
const response = await fetch(`/api/approvals/${id}/history`)
const { history } = await response.json()

history.forEach(entry => {
  console.log(`${entry.action} by ${entry.user.name} at ${entry.createdAt}`)
  console.log('Changes:', entry.changes)
})
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ endpoints —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ NextAuth
- –î–æ—Å—Ç—É–ø –∫ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –∫–æ–º–ø–∞–Ω–∏–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –¢–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –º–æ–≥—É—Ç –æ—Ç–≤–µ—á–∞—Ç—å
- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∞

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ —Å –Ω–æ–≤—ã–º–∏ API
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —É—á–∞—Å—Ç–Ω–∏–∫–∞–º
3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π
4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –æ—Ç—á–µ—Ç–æ–≤

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –î–æ–∫—É–º–µ–Ω—Ç—ã –Ω–µ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –µ—Å–ª–∏ `approvalRequired = true` –∏ –Ω–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è
- –ü—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–º
- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤–µ–¥–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
